<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Exercise Video - PhysioMilestones</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        /* Custom styles for the file upload area */
        .file-drop-area {
            border: 3px dashed #cbd5e1; /* slate-300 */
            border-radius: 1rem; /* rounded-xl */
            transition: all 0.2s ease-in-out;
        }
        .file-drop-area.dragover {
            border-color: #f59e0b; /* amber-500 */
            background-color: #fffbeb; /* amber-50 */
        }
        /* Hide the default file input */
        #video-upload-input {
            display: none;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-slate-900">Upload Exercise Video</h1>
                <p class="text-slate-500 mt-1">Record your child performing the exercise and upload it for analysis.</p>
            </div>
            <a href="#" class="bg-white border border-slate-300 text-slate-700 hover:bg-slate-50 font-semibold py-2 px-4 rounded-lg shadow-sm transition-colors">
                &larr; Back to Dashboard
            </a>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Left Panel: Instructions & Demo -->
            <section class="bg-white p-6 sm:p-8 rounded-2xl shadow-md">
                <h2 class="text-xl font-bold mb-4">Instructions for: <span class="text-amber-600">Squat Jumps</span></h2>
                
                <!-- YouTube Video Embed -->
                <div class="aspect-video rounded-xl overflow-hidden shadow-lg mb-6">
                    <!-- Replace with dynamic YouTube ID from your backend -->
                    <iframe width="100%" height="100%" src="https://www.youtube.com/embed/5xv0DKqe5XQ?si=hVAvReOO-TtSYIyU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>

                <!-- Instructions List -->
                <ul class="list-disc list-inside space-y-2 text-slate-600">
                    <!-- Replace with dynamic instructions from your backend -->
                    <li>Stand with your feet shoulder-width apart.</li>
                    <li>Lower your body into a squat position.</li>
                    <li>Jump up explosively.</li>
                    <li>Land softly and return to the squat position.</li>
                    <li>Aim for at least 10 repetitions in your video.</li>
                </ul>
            </section>

            <!-- Right Panel: Upload Form -->
            <section class="bg-white p-6 sm:p-8 rounded-2xl shadow-md">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="space-y-6">
                        <h2 class="text-xl font-bold">Upload Your Video</h2>
                        
                        <!-- File Drop Area -->
                        <div id="file-drop-area" class="file-drop-area p-8 text-center cursor-pointer">
                            <input type="file" name="exercise_video" id="video-upload-input" accept="video/*" required>
                            <div class="flex flex-col items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 12v9m0 0l-3-3m3 3l3-3" />
                                </svg>
                                <p id="file-info" class="mt-4 text-slate-500">
                                    <span class="font-semibold text-amber-600">Click to upload</span> or drag and drop.
                                </p>
                                <p class="text-xs text-slate-400 mt-1">MP4, MOV, AVI, or WMV. Max 100MB.</p>
                            </div>
                        </div>

                        <!-- Video Preview -->
                        <div id="video-preview-container" class="hidden aspect-video rounded-xl overflow-hidden shadow-inner bg-slate-100">
                            <video id="video-preview" controls class="w-full h-full"></video>
                        </div>
                        
                        <!-- Notes for the Doctor (Optional) -->
                        <div>
                            <label for="notes" class="block text-sm font-medium text-slate-700">Notes for the Doctor (Optional)</label>
                            <textarea name="notes" id="notes" rows="3" class="mt-1 block w-full px-4 py-3 bg-slate-50 border border-slate-300 rounded-lg shadow-sm placeholder-slate-400 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm transition" placeholder="e.g., 'My child felt a little discomfort in their left knee.'"></textarea>
                        </div>
                        
                        <!-- Submit Button -->
                        <div>
                            <button type="submit" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-amber-500 hover:bg-amber-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 transition-transform transform hover:scale-105 disabled:bg-slate-400 disabled:cursor-not-allowed" disabled>
                                Upload and Analyze
                            </button>
                        </div>
                    </div>
                </form>
            </section>
        </main>
    </div>

    <script>
        const dropArea = document.getElementById('file-drop-area');
        const fileInput = document.getElementById('video-upload-input');
        const fileInfo = document.getElementById('file-info');
        const videoPreviewContainer = document.getElementById('video-preview-container');
        const videoPreview = document.getElementById('video-preview');
        const submitButton = document.querySelector('button[type="submit"]');

        // Trigger file input when drop area is clicked
        dropArea.addEventListener('click', () => fileInput.click());

        // Drag and drop events
        dropArea.addEventListener('dragover', (event) => {
            event.preventDefault();
            dropArea.classList.add('dragover');
        });
        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('dragover');
        });
        dropArea.addEventListener('drop', (event) => {
            event.preventDefault();
            dropArea.classList.remove('dragover');
            const files = event.dataTransfer.files;
            if (files.length) {
                fileInput.files = files;
                handleFileChange({ target: fileInput });
            }
        });

        // Handle file selection
        fileInput.addEventListener('change', handleFileChange);

        function handleFileChange(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('video/')) {
                fileInfo.textContent = `Selected file: ${file.name}`;
                
                // Show video preview
                const reader = new FileReader();
                reader.onload = (e) => {
                    videoPreview.src = e.target.result;
                    videoPreviewContainer.classList.remove('hidden');
                };
                reader.readAsDataURL(file);

                submitButton.disabled = false;
            } else {
                fileInfo.textContent = 'Please select a valid video file.';
                videoPreviewContainer.classList.add('hidden');
                videoPreview.src = '';
                submitButton.disabled = true;
            }
        }
    </script>

</body>
</html>
